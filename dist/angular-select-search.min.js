angular.module("selectSearch",["vs-repeat"]).directive("selectSearch",function($window,$filter,$timeout,$animate){return{restrict:"A",templateUrl:"templates/angular-select-search.html",scope:{itemsAll:"=selectSearch",value:"=ngModel",name:"@",selected:"=",ngRequired:"=",ngDisabled:"=",ngChange:"&",ssHeight:"@",ssClass:"@",ssId:"@",content:"@",key:"@",placeholder:"@"},controller:function($scope){if($scope.items=$scope.itemsAll,$scope.ssHeight=$scope.ssHeight||200,$scope.length=$scope.itemsAll?$scope.itemsAll.length:0,$scope.content=$scope.content||"title",$scope.key=$scope.key||"value",$scope.placeholder=$scope.placeholder||"",$scope.index=-1,$scope.value&&$scope.itemsAll){var selected;for(var idx in $scope.itemsAll)if($scope.itemsAll[idx][$scope.key]==$scope.value){selected=$scope.itemsAll[idx];break}$scope.title=selected[$scope.content]}$scope.select=function(index,condition){index=parseInt(index),condition=angular.isDefined(condition)?condition:!0,condition&&($scope.index=index,angular.isDefined($scope.selected)&&($scope.selected=index),$scope.items[index]&&$scope.value!=$scope.items[index][$scope.key]&&$scope.ngChange(),angular.isDefined($scope.items[index])&&($scope.value=$scope.itemsAll[index][$scope.key],$scope.title=$scope.itemsAll[index][$scope.content]))},$scope.dropup=!1,$scope.reposition=function(){var pos=$scope.dropdownMenu.getBoundingClientRect(),spaceTop=pos.top,spaceBot=$window.innerHeight-pos.bottom;!$scope.dropup&&16>spaceBot?$scope.dropup=!0:$scope.dropup&&6>spaceTop&&($scope.dropup=!1),pos.bottom-pos.top>$window.innerHeight/2&&($scope.dropup=!1),$scope.$apply(),$timeout(function(){$scope.moveScroll()},0)},$scope.opened=!1,$scope.toggle=function(ev){ev.preventDefault(),ev.stopPropagation(),$scope.opened=!$scope.opened,$scope.opened||$scope.touched(),$scope.fix()},$scope.close=function(){$scope.opened&&($scope.touched(),$scope.el.blur()),$scope.opened=!1,$scope.$apply(),$scope.fix()},$scope.fix=function(){$scope.filter="",$timeout(function(){$scope.opened?($scope.searchInput.focus(),angular.element($window).bind("keydown",$scope.keydown),angular.element($window).bind("keyup",$scope.keyup)):(angular.element($window).unbind("keydown",$scope.keydown),angular.element($window).unbind("keyup",$scope.keyup)),$scope.reposition(),$scope.moveScroll()},10)},$scope.keydown=function(ev){27===ev.keyCode&&$scope.close(),40===ev.keyCode&&$scope.down(),38===ev.keyCode&&$scope.up(),13===ev.keyCode&&(ev.preventDefault(),ev.stopPropagation(),$scope.select($scope.index),$scope.close()),$timeout(function(){$scope.moveScroll()},0)},$scope.keyup=function(ev){$timeout(function(){$scope.moveScroll()},0)},$scope.down=function(){$scope.index+1<$scope.items.length&&($scope.index++,$scope.$apply(),$timeout(function(){$scope.moveScroll()},0))},$scope.up=function(){$scope.index-1;$scope.index-1>=0&&($scope.index-=1,$scope.$apply(),$timeout(function(){$scope.moveScroll()},0))},$scope.moveScroll=function(){$scope.index>=0&&$scope.$broadcast("vsRepeatTrigger",{scrollIndex:$scope.index,scrollIndexPosition:"inview#auto"})},$scope.removeWatchers=$scope.$watch("[filter,value,itemsAll]",function(){$scope.items=$filter("filter")($scope.itemsAll,$scope.filter),$scope.index=-1,$scope.moveScroll()},!0),$scope.noop=function(ev){ev.preventDefault(),ev.stopPropagation()}},link:function(scope,element,attrs){scope.el=element,Array.prototype.forEach.call(element.find("div"),function(elem){angular.element(elem).hasClass("dropdown-menu")?scope.dropdownMenu=elem:angular.element(elem).hasClass("bs-searchbox")&&(scope.searchInput=angular.element(elem).find("input")[0])}),scope.touched=function(){var formController=element.controller("form");angular.isDefined(formController)&&angular.isDefined(scope.name)&&(formController[scope.name].$touched=!0,formController[scope.name].$untouched=!1,scope.ngRequired?formController[scope.name].$setValidity("required",angular.isDefined(scope.value)):formController[scope.name].$setValidity("required",!0)),$animate.setClass(element,"ng-touched","ng-untouched")},angular.element($window).bind("resize",scope.reposition).bind("scroll",scope.reposition).bind("click",scope.close),scope.$on("$destroy",function(){scope.removeWatchers(),angular.element($window).unbind("resize",scope.reposition).unbind("scroll",scope.reposition).unbind("click",scope.close)})}}});
angular.module("selectSearch").run(["$templateCache",function($templateCache){$templateCache.put("templates/angular-select-search.html",'<div ng-class="{ open: opened, dropup: dropup }"\n  class="btn-group bootstrap-select {{ssClass}}">\n    <button ng-click="toggle($event)"\n      id="{{ssId}}" ng-disabled="ngDisabled"\n      type="button" class="btn dropdown-toggle btn-default">\n        <span data-ng-show="!value" class="filter-option pull-left">{{placeholder}}</span>\n        <span data-ng-show="value" class="filter-option pull-left">{{title}}</span>\n        &nbsp;<span class="caret"></span>\n    </button>\n\n    <div ng-show="opened" class="dropdown-menu">\n        <div class="bs-searchbox" ng-show="length >= 10">\n            <input ng-model="filter" ng-click="noop($event)" type="text"\n              class="input-block-level form-control" autocomplete="off" />\n        </div>\n        <ul vs-repeat vs-options="{latch: true}" vs-excess="20" ng-show="opened" class="dropdown-menu inner"\n          style="display: block; overflow-y: auto; min-height: 0px;max-height:200px;position: relative;" >\n            {{ select(selected, (selected >= 0 && index === -1)) }}\n            <li ng-repeat="item in items | filter: filter"\n              ng-class="{ active: (index == startIndex+$index) }" style="position: absolute; width: 100%;">\n                {{ select(startIndex+$index, (index === -1 && item[key] == value)) }}\n                <a ng-click="select(startIndex+$index)">{{item[content]}}</a>\n            </li>\n        </ul>\n    </div>\n</div>')}]);
!function(window,angular){"use strict";function getWindowScroll(){if("pageYOffset"in window)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var sx,sy,d=document,r=d.documentElement,b=d.body;return sx=r.scrollLeft||b.scrollLeft||0,sy=r.scrollTop||b.scrollTop||0,{scrollTop:sy,scrollLeft:sx}}function getClientSize(element,sizeProp){return element===window?"clientWidth"===sizeProp?window.innerWidth:window.innerHeight:element[sizeProp]}function getScrollPos(element,scrollProp){return element===window?getWindowScroll()[scrollProp]:element[scrollProp]}function getScrollOffset(vsElement,scrollElement,isHorizontal){var vsPos=vsElement.getBoundingClientRect()[isHorizontal?"left":"top"],scrollPos=scrollElement===window?0:scrollElement.getBoundingClientRect()[isHorizontal?"left":"top"],correction=vsPos-scrollPos+(scrollElement===window?getWindowScroll():scrollElement)[isHorizontal?"scrollLeft":"scrollTop"];return correction}var isMacOS=-1!=navigator.appVersion.indexOf("Mac"),wheelEventName="undefined"!=typeof window.onwheel?"wheel":"undefined"!=typeof window.onmousewheel?"mousewheel":"DOMMouseScroll",dde=document.documentElement,matchingFunction=dde.matches?"matches":dde.matchesSelector?"matchesSelector":dde.webkitMatches?"webkitMatches":dde.webkitMatchesSelector?"webkitMatchesSelector":dde.msMatches?"msMatches":dde.msMatchesSelector?"msMatchesSelector":dde.mozMatches?"mozMatches":dde.mozMatchesSelector?"mozMatchesSelector":null,closestElement=angular.element.prototype.closest||function(selector){for(var el=this[0].parentNode;el!==document.documentElement&&null!=el&&!el[matchingFunction](selector);)el=el.parentNode;return el&&el[matchingFunction](selector)?angular.element(el):angular.element()};angular.module("vs-repeat",[]).directive("vsRepeat",["$compile",function($compile){return{restrict:"A",scope:!0,require:"?^vsRepeat",controller:["$scope",function($scope){this.$scrollParent=$scope.$scrollParent,this.$fillElement=$scope.$fillElement}],compile:function($element){var ngRepeatChild=$element.children().eq(0),ngRepeatExpression=ngRepeatChild.attr("ng-repeat")||ngRepeatChild.attr("data-ng-repeat"),childCloneHtml=ngRepeatChild[0].outerHTML,expressionMatches=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(ngRepeatExpression),lhs=expressionMatches[1],rhs=expressionMatches[2],rhsSuffix=expressionMatches[3],collectionName="$vs_collection",attributesDictionary={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};return $element.empty(),window.getComputedStyle&&"absolute"===window.getComputedStyle($element[0]).position||$element.css("position","relative"),{pre:function($scope,$element,$attrs,$ctrl){function refresh(event,data){if(!originalCollection||originalCollection.length<1)return $scope[collectionName]=[],originalLength=0,resizeFillElement(0),void($scope.sizesCumulative=[0]);if(originalLength=originalCollection.length,sizesPropertyExists){$scope.sizes=originalCollection.map(function(item){var s=$scope.$new(!1);angular.extend(s,item),s[lhs]=item;var size=$attrs.vsSize||$attrs.vsSizeProperty?s.$eval($attrs.vsSize||$attrs.vsSizeProperty):$scope.elementSize;return s.$destroy(),size});var sum=0;$scope.sizesCumulative=$scope.sizes.map(function(size){var res=sum;return sum+=size,res}),$scope.sizesCumulative.push(sum)}else setAutoSize();reinitialize(data)}function setAutoSize(){autoSize&&$scope.$$postDigest(function(){if($element[0].offsetHeight||$element[0].offsetWidth)for(var children=$element.children(),i=0;i<children.length;){if(null!=children[i].attributes["ng-repeat"]||null!=children[i].attributes["data-ng-repeat"]){children[i][offsetSize]&&($scope.elementSize=children[i][offsetSize],reinitialize(),autoSize=!1,$scope.$root&&!$scope.$root.$$phase&&$scope.$apply());break}i++}else var dereg=$scope.$watch(function(){($element[0].offsetHeight||$element[0].offsetWidth)&&(dereg(),setAutoSize())})})}function wheelHandler(e){var elem=e.currentTarget;(elem.scrollWidth>elem.clientWidth||elem.scrollHeight>elem.clientHeight)&&$wheelHelper.css("display","block")}function onWindowResize(){"undefined"!=typeof $attrs.vsAutoresize&&(autoSize=!0,setAutoSize(),$scope.$root&&!$scope.$root.$$phase&&$scope.$apply()),updateInnerCollection()&&($scope.$apply(),$scope.$broadcast("vsSetOffset-refresh"))}function reinitialize(data){_prevStartIndex=void 0,_prevEndIndex=void 0,_minStartIndex=originalLength,_maxEndIndex=0,updateInnerCollection(data),resizeFillElement(sizesPropertyExists?$scope.sizesCumulative[originalLength]:$scope.elementSize*originalLength),$scope.$evalAsync(function(){$scope.$broadcast("vsSetOffset-refresh")}),$scope.$emit("vsRepeatReinitialized",$scope.startIndex,$scope.endIndex)}function resizeFillElement(size){if($$horizontal){if($fillElement.css({width:$scope.offsetBefore+size+$scope.offsetAfter+"px",height:"100%"}),$ctrl&&$ctrl.$fillElement){var referenceElement=$ctrl.$fillElement[0].parentNode.querySelector("[ng-repeat]");referenceElement&&$ctrl.$fillElement.css({width:referenceElement.scrollWidth+"px"})}}else $fillElement.css({height:$scope.offsetBefore+size+$scope.offsetAfter+"px",width:"100%"}),$ctrl&&$ctrl.$fillElement&&(referenceElement=$ctrl.$fillElement[0].parentNode.querySelector("[ng-repeat]"),referenceElement&&$ctrl.$fillElement.css({height:referenceElement.scrollHeight+"px"}))}function reinitOnClientHeightChange(){var ch=getClientSize($scrollParent[0],clientSize);ch!==_prevClientSize&&(reinitialize(),$scope.$root&&!$scope.$root.$$phase&&($scope.$apply(),$scope.$broadcast("vsSetOffset-refresh"))),_prevClientSize=ch}function scrollToPosition(scrollTo){var scrolled=!1;return void 0!==scrollTo&&"number"==typeof scrollTo&&(scrolled=Math.max(scrollTo,0),$scrollParent[0][scrollPos]!==scrolled?($scrollParent[0][scrollPos]=scrolled,localScrollTrigger=!0):scrolled=!1,$scope.$emit("vsRepeatScrolled",scrolled)),scrolled}function updateInnerCollection(data){var position,visibleStartIndex,scrollIndexCumulativeSize,scrollIndexSize,$scrollPosition=getScrollPos($scrollParent[0],scrollPos),$clientSize=getClientSize($scrollParent[0],clientSize),scrollOffset=$element[0]===$scrollParent[0]?0:getScrollOffset($element[0],$scrollParent[0],$$horizontal),scrollChange=!0,__startIndex=$scope.startIndex,__endIndex=$scope.endIndex;if(data&&void 0!==data.elementSize&&($scope.elementSize=data.elementSize),data&&void 0!==data.scrollIndex){if("undefined"!=typeof $scope.scrollSettings&&($scope.scrollSettings.scrollIndex=data.scrollIndex),sizesPropertyExists?(scrollIndexSize=$scope.sizes[data.scrollIndex],scrollIndexCumulativeSize=$scope.sizesCumulative[data.scrollIndex]):(scrollIndexSize=$scope.elementSize,scrollIndexCumulativeSize=data.scrollIndex*$scope.elementSize),void 0!==data.scrollIndexPosition)switch("undefined"!=typeof $scope.scrollSettings&&($scope.scrollSettings.scrollIndexPosition=data.scrollIndexPosition),position=0,typeof data.scrollIndexPosition){case"number":position=data.scrollIndexPosition+$scope.offsetBefore;break;case"string":switch(data.scrollIndexPosition){case"top":position=$scope.offsetBefore;break;case"middle":position=($clientSize-scrollIndexSize)/2;break;case"bottom":position=$clientSize-scrollIndexSize-$scope.offsetAfter;break;case"inview":case"inview#top":case"inview#middle":case"inview#bottom":case"inview#auto":$scrollParent[0][scrollPos]<=scrollIndexCumulativeSize&&$scrollParent[0][scrollPos]+$clientSize-scrollIndexSize>=scrollIndexCumulativeSize?(scrollChange=!1,position=scrollIndexCumulativeSize-$scrollParent[0][scrollPos]):(("inview#top"===data.scrollIndexPosition||"inview"===data.scrollIndexPosition)&&(position=$scope.offsetBefore),"inview#bottom"===data.scrollIndexPosition&&(position=$clientSize-scrollIndexSize+$scope.offsetAfter),"inview#middle"===data.scrollIndexPosition&&(position=($clientSize-scrollIndexSize)/2),"inview#auto"===data.scrollIndexPosition&&(position=$scrollParent[0][scrollPos]<=scrollIndexCumulativeSize?$clientSize-scrollIndexSize+$scope.offsetAfter:$scope.offsetBefore));break;default:console.warn("Incorrect scrollIndexPosition string value")}break;default:console.warn("Incorrect scrollIndexPosition type")}else scrollChange=!1,position=sizesPropertyExists?$scope.sizesCumulative[data.scrollIndex]-$scrollParent[0][scrollPos]:data.scrollIndex*$scope.elementSize-$scrollParent[0][scrollPos];if(__startIndex=data.scrollIndex,sizesPropertyExists){for(;$scope.sizesCumulative[__startIndex]>$scope.sizesCumulative[data.scrollIndex]-position;)__startIndex--;for(visibleStartIndex=Math.max(__startIndex,0),__startIndex=Math.max(Math.floor(__startIndex-$scope.excess/2),0),__endIndex=__startIndex;$scope.sizesCumulative[__endIndex]<$scope.sizesCumulative[visibleStartIndex]-$scope.offsetBefore+$clientSize;)__endIndex++;__endIndex=Math.min(Math.ceil(__endIndex+$scope.excess/2),originalLength)}else{for(;__startIndex*$scope.elementSize>data.scrollIndex*$scope.elementSize-position;)__startIndex--;visibleStartIndex=Math.max(__startIndex,0),__startIndex=Math.max(Math.floor(__startIndex-$scope.excess/2),0),__endIndex=Math.min(__startIndex+Math.ceil($clientSize/$scope.elementSize)+$scope.excess/2,originalLength)}}else if(sizesPropertyExists){for(__startIndex=0;$scope.sizesCumulative[__startIndex]<$scrollPosition-$scope.offsetBefore-scrollOffset;)__startIndex++;for(__startIndex>0&&__startIndex--,__startIndex=Math.max(Math.floor(__startIndex-$scope.excess/2),0),__endIndex=__startIndex;$scope.sizesCumulative[__endIndex]<$scrollPosition-$scope.offsetBefore-scrollOffset+$clientSize;)__endIndex++;__endIndex=Math.min(Math.ceil(__endIndex+$scope.excess/2),originalLength)}else __startIndex=Math.max(Math.floor(($scrollPosition-$scope.offsetBefore-scrollOffset)/$scope.elementSize)-$scope.excess/2,0),__endIndex=Math.min(__startIndex+Math.ceil($clientSize/$scope.elementSize)+$scope.excess,originalLength);_minStartIndex=Math.min(__startIndex,_minStartIndex),_maxEndIndex=Math.max(__endIndex,_maxEndIndex),$scope.startIndex=$$options.latch?_minStartIndex:__startIndex,$scope.endIndex=$$options.latch?_maxEndIndex:__endIndex,void 0!==data&&void 0!==data.scrollIndex&&void 0!==position&&scrollChange&&scrollToPosition(scrollIndexCumulativeSize-position);var digestRequired=!1;return null==_prevStartIndex?digestRequired=!0:null==_prevEndIndex&&(digestRequired=!0),digestRequired||($$options.hunked?Math.abs($scope.startIndex-_prevStartIndex)>=$scope.excess/2||0===$scope.startIndex&&0!==_prevStartIndex?digestRequired=!0:(Math.abs($scope.endIndex-_prevEndIndex)>=$scope.excess/2||$scope.endIndex===originalLength&&_prevEndIndex!==originalLength)&&(digestRequired=!0):digestRequired=$scope.startIndex!==_prevStartIndex||$scope.endIndex!==_prevEndIndex),digestRequired&&($scope[collectionName]=originalCollection.slice($scope.startIndex,$scope.endIndex),$scope.$emit("vsRepeatInnerCollectionUpdated",$scope.startIndex,$scope.endIndex,_prevStartIndex,_prevEndIndex),_prevStartIndex=$scope.startIndex,_prevEndIndex=$scope.endIndex),digestRequired}var originalLength,$wheelHelper,$fillElement,childClone=angular.element(childCloneHtml),originalCollection=[],$$horizontal="undefined"!=typeof $attrs.vsHorizontal,autoSize=!$attrs.vsRepeat,sizesPropertyExists=!!$attrs.vsSize||!!$attrs.vsSizeProperty,$scrollParent=$attrs.vsScrollParent?"window"===$attrs.vsScrollParent?angular.element(window):closestElement.call($element,$attrs.vsScrollParent):$element,positioningProperty=$$horizontal?"left":"top",localScrollTrigger=!1,$$options="vsOptions"in $attrs?$scope.$eval($attrs.vsOptions):{},clientSize=$$horizontal?"clientWidth":"clientHeight",offsetSize=$$horizontal?"offsetWidth":"offsetHeight",scrollPos=$$horizontal?"scrollLeft":"scrollTop";if(!("vsSize"in $attrs)&&"vsSizeProperty"in $attrs&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attrubute which also accepts angular expressions."),0===$scrollParent.length)throw"Specified scroll parent selector did not match any element";$scope.$scrollParent=$scrollParent,sizesPropertyExists&&($scope.sizesCumulative=[]),$scope.elementSize=+$attrs.vsRepeat||getClientSize($scrollParent[0],clientSize)||50,$scope.offsetBefore=0,$scope.offsetAfter=0,$scope.excess=2,$scope.scrollSettings={scrollIndex:0,scrollIndexPosition:"top"},$scope.$watch($attrs.vsScrollSettings,function(newValue){"undefined"!=typeof newValue&&($scope.scrollSettings=newValue,reinitialize($scope.scrollSettings))},!0),Object.keys(attributesDictionary).forEach(function(key){$attrs[key]&&$attrs.$observe(key,function(value){$scope[attributesDictionary[key]]=+value,reinitialize()})}),$scope.$watchCollection(rhs,function(coll){originalCollection=coll||[],refresh()}),childClone.attr("ng-repeat",lhs+" in "+collectionName+(rhsSuffix?" "+rhsSuffix:"")).addClass("vs-repeat-repeated-element");var offsetCalculationString=sizesPropertyExists?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)";childClone.attr("vs-set-offset",offsetCalculationString),childClone.attr("vs-set-offset-positioning-property",positioningProperty),$compile(childClone)($scope),$element.append(childClone),$fillElement=angular.element('<div class="vs-repeat-fill-element"></div>').css({position:"relative","min-height":"100%","min-width":"100%"}),$element.append($fillElement),$compile($fillElement)($scope),$scope.$fillElement=$fillElement;var _prevMouse={};isMacOS&&"window"!==$attrs.vsScrollParent&&($wheelHelper=angular.element('<div class="vs-repeat-wheel-helper"></div>').on(wheelEventName,function(e){e.preventDefault(),e.stopPropagation(),e.originalEvent&&(e=e.originalEvent),$scrollParent[0].scrollLeft+=e.deltaX||-e.wheelDeltaX,$scrollParent[0].scrollTop+=e.deltaY||-e.wheelDeltaY}).on("mousemove",function(e){(_prevMouse.x!==e.clientX||_prevMouse.y!==e.clientY)&&angular.element(this).css("display","none"),_prevMouse={x:e.clientX,y:e.clientY}}).css("display","none"),$fillElement.append($wheelHelper)),$scope.startIndex=0,$scope.endIndex=0,$scrollParent.on("scroll",function(){localScrollTrigger?localScrollTrigger=!1:updateInnerCollection()&&($scope.$apply(),$scope.$broadcast("vsSetOffset-refresh"))}),isMacOS&&$scrollParent.on(wheelEventName,wheelHandler),angular.element(window).on("resize",onWindowResize),$scope.$on("$destroy",function(){angular.element(window).off("resize",onWindowResize)}),$scope.$on("vsRepeatTrigger",refresh),$scope.$on("vsRepeatResize",function(){autoSize=!0,setAutoSize()});var _prevStartIndex,_prevEndIndex,_minStartIndex,_maxEndIndex,_prevClientSize;$scope.$watch(function(){"function"==typeof window.requestAnimationFrame?window.requestAnimationFrame(reinitOnClientHeightChange):reinitOnClientHeightChange()})}}}}}]).directive("vsSetOffset",[function(){return function($scope,$element,$attrs){function setOffset(){$element.css(positioningProperty,$scope.$eval($attrs.vsSetOffset)+"px")}var positioningProperty=$attrs.vsSetOffsetPositioningProperty;setOffset(),$scope.$on("vsSetOffset-refresh",setOffset)}}]),angular.element(document.head).append(["<style>.vs-repeat-wheel-helper{position: absolute;top: 0;bottom: 0;left: 0;right: 0;z-index: 99999;background: rgba(0, 0, 0, 0);}.vs-repeat-repeated-element{position: absolute;z-index: 1;}</style>"].join(""))}(window,window.angular);